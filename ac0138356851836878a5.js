(self.webpackChunkwebtool_totp=self.webpackChunkwebtool_totp||[]).push([[853],{2442:(e,t,o)=>{var n=o(5872).Buffer,r=o(5906),a={gen:function(e,t){e=e||"";var o=(t=t||{}).counter||0,a=new n(l(o)),s=r.createHmac("sha1",new n(e)).update(a).digest("hex"),i=c(s),d=15&i[19],u=(127&i[d])<<24|(255&i[d+1])<<16|(255&i[d+2])<<8|255&i[d+3];return(u+="").substr(u.length-6,6)},verify:function(e,t,o){for(var n=(o=o||{}).window||50,r=o.counter||0,a=r-n;a<=r+n;++a)if(o.counter=a,this.gen(t,o)===e)return{delta:a-r};return null}},s={gen:function(e,t){var o=(t=t||{}).time||30,n=(new Date).getTime();if(t._t)throw new Error("cannot overwrite time in non-test environment!");return t.counter=Math.floor(n/1e3/o),a.gen(e,t)},verify:function(e,t,o){var n=(o=o||{}).time||30,r=(new Date).getTime();if(o._t)throw new Error("cannot overwrite time in non-test environment!");return o.counter=Math.floor(r/1e3/n),a.verify(e,t,o)}};e.exports.H=s;var l=function(e){for(var t=[],o=7;o>=0;--o)t[o]=255&e,e>>=8;return t},c=function(e){for(var t=[],o=0;o<e.length;o+=2)t.push(parseInt(e.substr(o,2),16));return t}},5911:(e,t,o)=>{var n=o(7526);t.encode=n.encode,t.decode=n.decode},7526:(e,t,o)=>{"use strict";var n=o(5872).Buffer,r=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];t.encode=function(e){n.isBuffer(e)||(e=new n(e));for(var t,o,r=0,a=0,s=0,l=0,c=new n(8*(t=e,o=Math.floor(t.length/5),t.length%5==0?o:o+1));r<e.length;){var i=e[r];s>3?(l=(l=i&255>>s)<<(s=(s+5)%8)|(r+1<e.length?e[r+1]:0)>>8-s,r++):(l=i>>8-(s+5)&31,0===(s=(s+5)%8)&&r++),c[a]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(l),a++}for(r=a;r<c.length;r++)c[r]=61;return c},t.decode=function(e){var t,o=0,a=0,s=0;n.isBuffer(e)||(e=new n(e));for(var l=new n(Math.ceil(5*e.length/8)),c=0;c<e.length&&61!==e[c];c++){var i=e[c]-48;if(!(i<r.length))throw new Error("Invalid input - it is not base32 encoded string");a=r[i],o<=3?0===(o=(o+5)%8)?(t|=a,l[s]=t,s++,t=0):t|=255&a<<8-o:(t|=255&a>>>(o=(o+5)%8),l[s]=t,s++,t=255&a<<8-o)}return l.slice(0,s)}},4853:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>ee});var n={};o.r(n),o.d(n,{render:()=>m});var r={};o.r(r),o.d(r,{render:()=>k});var a={};o.r(a),o.d(a,{render:()=>V});var s={};o.r(s),o.d(s,{render:()=>y});var l={};o.r(l),o.d(l,{render:()=>x});var c={};o.r(c),o.d(c,{render:()=>_});var i={};o.r(i),o.d(i,{render:()=>q});var d={};o.r(d),o.d(d,{render:()=>Q});var u={};o.r(u),o.d(u,{render:()=>X});var p=o(5415);function m(e,t){const o=(0,p.resolveComponent)("b-navbar-brand"),n=(0,p.resolveComponent)("b-icon"),r=(0,p.resolveComponent)("b-nav-item"),a=(0,p.resolveComponent)("b-navbar-nav"),s=(0,p.resolveComponent)("b-navbar"),l=(0,p.resolveComponent)("UnlockForm"),c=(0,p.resolveComponent)("b-col"),i=(0,p.resolveComponent)("b-button"),d=(0,p.resolveComponent)("b-card-title"),u=(0,p.resolveComponent)("b-card-header"),m=(0,p.resolveComponent)("TOTPList"),f=(0,p.resolveComponent)("b-card-body"),h=(0,p.resolveComponent)("b-card"),w=(0,p.resolveComponent)("b-row"),v=(0,p.resolveComponent)("b-container");return(0,p.openBlock)(),(0,p.createElementBlock)(p.Fragment,null,[(0,p.createVNode)(s,{type:"dark",variant:"dark"},{default:(0,p.withCtx)((()=>[(0,p.createVNode)(o,null,{default:(0,p.withCtx)((()=>[(0,p.createTextVNode)("TOTP")])),_:1}),e.authUris.length>0?((0,p.openBlock)(),(0,p.createBlock)(a,{key:0,class:"ml-auto"},{default:(0,p.withCtx)((()=>[(0,p.createVNode)(r,null,{default:(0,p.withCtx)((()=>[(0,p.createVNode)(n,{icon:"save",onClick:e.showExportModal},null,8,["onClick"])])),_:1})])),_:1})):(0,p.createCommentVNode)("",!0)])),_:1}),(0,p.createVNode)(v,{class:"mt-3 px-2"},{default:(0,p.withCtx)((()=>[(0,p.createVNode)(w,{class:"justify-content-md-center"},{default:(0,p.withCtx)((()=>[e.route.query.s&&0===e.authUris.length?((0,p.openBlock)(),(0,p.createBlock)(c,{key:0},{default:(0,p.withCtx)((()=>[(0,p.createVNode)(l,{onOk:t[0]||(t[0]=t=>e.setAuthUris(t))})])),_:1})):((0,p.openBlock)(),(0,p.createBlock)(c,{key:1},{default:(0,p.withCtx)((()=>[(0,p.createVNode)(h,{class:"m-1","no-body":""},{default:(0,p.withCtx)((()=>[(0,p.createVNode)(u,null,{default:(0,p.withCtx)((()=>[(0,p.createVNode)(d,null,{default:(0,p.withCtx)((()=>[(0,p.createTextVNode)("OTP"),(0,p.createVNode)(i,{class:"mx-1 px-1 py-0",onClick:e.showTotpAuthForm},{default:(0,p.withCtx)((()=>[(0,p.createVNode)(n,{icon:"plus"})])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,p.createVNode)(f,null,{default:(0,p.withCtx)((()=>[(0,p.createVNode)(m,{"auth-uris":e.authUris},null,8,["auth-uris"])])),_:1})])),_:1})])),_:1}))])),_:1})])),_:1})],64)}var f=o(5911);const h=new TextDecoder;function w(e){return f.decode(e)}function v(e){const t=w(e),o=(n=t,h.decode(f.encode(n)));var n;const r=w(o);if(s=r,(a=t).byteLength!==s.byteLength||!a.every(((e,t)=>e===s[t])))throw new Error("invalid base32 format");var a,s;return o}const C={parse:function(e){if("string"!=typeof e)throw new Error("invalid format");const{search:t,searchParams:o}=new URL(e),n=o.get("secret");if(!n)throw new Error("invalid format");try{if(!f.decode(n).length)throw new Error("invalid format")}catch(e){throw new Error("invalid format")}const r=e.split("otpauth://totp/")[1];if(!r)throw new Error("invalid format");const a=decodeURIComponent(r.split(t)[0]);if(!a)throw new Error("invalid format");const s=o.get("issuer");let l=a;const c=a.split(/: ?/);return s===c[0]&&(l=c[1]),{issuer:s,accountName:l,secret:n}},stringify:function({accountName:e,secret:t,issuer:o}){let n=`/${e}`;o&&(n=`/${o}%3A${e}`);const r=new URL(n,"otpauth://totp/");return r.searchParams.set("secret",v(t)),o&&r.searchParams.set("issuer",o),r.toString()}};function k(e,t){const o=(0,p.resolveComponent)("TOTPListItem"),n=(0,p.resolveComponent)("b-list-group");return(0,p.openBlock)(),(0,p.createBlock)(n,null,{default:(0,p.withCtx)((()=>[((0,p.openBlock)(!0),(0,p.createElementBlock)(p.Fragment,null,(0,p.renderList)(e.authUris,(e=>((0,p.openBlock)(),(0,p.createBlock)(o,{authUri:e},null,8,["authUri"])))),256))])),_:1})}var N=o(2442);function V(e,t){return(0,p.renderSlot)(e.$slots,"default")}const b=(0,p.defineComponent)({compatConfig:{MODE:3},...a,props:{modelValue:String,interval:{type:Number,default:1e3},secret:String},setup(e,{emit:t}){let o;function n(){const o=f.decode(e.secret);t("update:modelValue",N.H.gen(o))}(0,p.onMounted)((function(){n(),o=setInterval((function(){n()}),e.interval)})),(0,p.onUnmounted)((function(){clearInterval(o)}))}});function y(e,t){const o=(0,p.resolveComponent)("TOTPTicker");return(0,p.openBlock)(),(0,p.createBlock)(o,{secret:e.secret,modelValue:e.totp,"onUpdate:modelValue":t[0]||(t[0]=t=>e.totp=t)},{default:(0,p.withCtx)((()=>[(0,p.renderSlot)(e.$slots,"default",{accountName:e.accountName,issuer:e.issuer,totp:e.totp,secret:e.secret})])),_:3},8,["secret","modelValue"])}const g=(0,p.defineComponent)({...s,components:{TOTPTicker:b},props:{authUri:{validator(e){try{C.parse(e)}catch(e){return!1}return!0}}},setup(e){const t=C.parse(e.authUri),o=(0,p.ref)(t.secret),n=(0,p.ref)(t.accountName);return{issuer:(0,p.ref)(t.issuer),accountName:n,secret:o,totp:(0,p.ref)("")}}});function x(e,t){const o=(0,p.resolveComponent)("TOTPAuthOutlet"),n=(0,p.resolveComponent)("b-list-group-item");return(0,p.openBlock)(),(0,p.createBlock)(n,null,{default:(0,p.withCtx)((()=>[(0,p.createVNode)(o,{authUri:e.authUri},{default:(0,p.withCtx)((({issuer:e,secret:t,totp:o,accountName:n})=>[(0,p.createElementVNode)("div",null,(0,p.toDisplayString)(e),1),(0,p.createElementVNode)("div",null,"("+(0,p.toDisplayString)(n)+")",1),(0,p.createElementVNode)("div",null,(0,p.toDisplayString)(o),1)])),_:1},8,["authUri"])])),_:1})}const E=(0,p.defineComponent)({...l,components:{TOTPAuthOutlet:g},props:{authUri:String},setup:e=>({})}),T=(0,p.defineComponent)({...r,components:{TOTPListItem:E},props:{authUris:Array},setup(e,{emit:t}){const{authUris:o}=e;return{authUris:o}}}),U=["onSubmit"],O={class:"d-none",ref:"submit",type:"submit"},B={class:"input-group"},M={class:"input-group"},S={class:"input-group"};function _(e,t){const o=(0,p.resolveComponent)("b-modal");return(0,p.openBlock)(),(0,p.createBlock)(o,{ref:"modal",size:"md",onOk:e.onModalOk,onShown:e.onModalShown,onHidden:e.onModalHidden,centered:""},{"modal-title":(0,p.withCtx)((()=>[(0,p.createTextVNode)("New")])),default:(0,p.withCtx)((({ok:o})=>[(0,p.createElementVNode)("form",{class:"form",onSubmit:(0,p.withModifiers)(o,["prevent"])},[(0,p.createElementVNode)("button",O,null,512),(0,p.createElementVNode)("div",B,[(0,p.withDirectives)((0,p.createElementVNode)("input",{class:"form-control",type:"text","onUpdate:modelValue":t[0]||(t[0]=t=>e.form.issuer=t),placeholder:"issuer"},null,512),[[p.vModelText,e.form.issuer]])]),(0,p.createElementVNode)("div",M,[(0,p.withDirectives)((0,p.createElementVNode)("input",{class:"form-control",type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.form.accountName=t),placeholder:"account name",required:""},null,512),[[p.vModelText,e.form.accountName]])]),(0,p.createElementVNode)("div",S,[(0,p.withDirectives)((0,p.createElementVNode)("input",{class:"form-control",type:"new-password","onUpdate:modelValue":t[2]||(t[2]=t=>e.form.secret=t),placeholder:"secret",required:""},null,512),[[p.vModelText,e.form.secret]])])],40,U)])),_:1},8,["onOk","onShown","onHidden"])}const P=(0,p.defineComponent)({...c,compatConfig:{MODE:3},components:{},emits:{ok:(e,t)=>"object"==typeof e&&"function"==typeof e.preventDefault&&"object"==typeof t},props:{onOk:{type:Function,required:!0},onHidden:{type:Function,default(){}},onShown:{type:Function,default(){}}},setup(e,{emit:t}){const o=(0,p.reactive)({secret:"",issuer:"",accountName:""}),n=(0,p.getCurrentInstance)();return{form:o,show(){const{modal:e}=n.refs;e.show()},onModalOk(e){t("ok",e,o)},onModalHidden(e){t("hidden",e)},onModalShown(e){t("shown",e)}}}});function D(e,t){const o=document.createElement("span");document.body.appendChild(o);const n=(0,p.createVNode)(P,{...t,onHidden(){(0,p.render)(null,o),o.remove()}});n.appContext={...e.appContext},(0,p.render)(n,o);const{componentInstance:r}=n;return r.show(),r}var A=o(2721);const H=(0,p.createElementVNode)("input",{hidden:"",type:"text",autocomplete:"username"},null,-1),I={key:0},F={class:"btn btn-secondary",type:"submit"};function q(e,t){const o=(0,p.resolveComponent)("b-form-input"),n=(0,p.resolveComponent)("b-icon"),r=(0,p.resolveComponent)("b-input-group");return(0,p.openBlock)(),(0,p.createElementBlock)("form",{class:"form form",onSubmit:t[1]||(t[1]=(0,p.withModifiers)(((...t)=>e.handle&&e.handle(...t)),["prevent"]))},[H,e.route.query.tips?((0,p.openBlock)(),(0,p.createElementBlock)("label",I,"tips: "+(0,p.toDisplayString)(e.route.query.tips),1)):(0,p.createCommentVNode)("",!0),(0,p.createVNode)(r,null,{append:(0,p.withCtx)((()=>[(0,p.createElementVNode)("button",F,[(0,p.createVNode)(n,{icon:"unlock-fill"})])])),default:(0,p.withCtx)((()=>[(0,p.createVNode)(o,{type:"password",autocomplete:"current-password",modelValue:e.form.password,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.password=t),placeholder:"password"},null,8,["modelValue"])])),_:1})],32)}var L=o(5054),R=o(5031);const $=(0,p.defineComponent)({...i,setup(e,{emit:t}){const o=(0,A.yj)(),n=(0,R.oR)(),r=L.O.decrypt.bind({$store:n}),a=(0,p.reactive)({password:""});return{form:a,route:o,async handle(){const e=o.query.s,n=await r({password:a.password,chipher:e}),s=JSON.parse(n);t("ok",s)}}}}),j=(0,p.createElementVNode)("input",{hidden:"",type:"text",autocomplete:"username"},null,-1),J=(0,p.createElementVNode)("button",{class:"d-none",type:"submit"},null,-1),z={class:"input-group"},G={class:"input-group"},K={class:"input-group"};function Q(e,t){const o=(0,p.resolveComponent)("b-form");return(0,p.openBlock)(),(0,p.createBlock)(o,{onSubmit:t[3]||(t[3]=(0,p.withModifiers)((t=>e.validate()&&e.submit()),["prevent"]))},{default:(0,p.withCtx)((()=>[j,J,(0,p.createElementVNode)("div",z,[(0,p.withDirectives)((0,p.createElementVNode)("input",{class:"form-control",type:"password",autocomplete:"new-password","onUpdate:modelValue":t[0]||(t[0]=t=>e.form.newPassword=t),placeholder:"export password",required:""},null,512),[[p.vModelText,e.form.newPassword]])]),(0,p.createElementVNode)("div",G,[(0,p.withDirectives)((0,p.createElementVNode)("input",{class:"form-control",type:"password",autocomplete:"new-password","onUpdate:modelValue":t[1]||(t[1]=t=>e.form.confirmPassword=t),placeholder:"confirm password",required:""},null,512),[[p.vModelText,e.form.confirmPassword]])]),(0,p.createElementVNode)("div",K,[(0,p.withDirectives)((0,p.createElementVNode)("input",{class:"form-control",type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.form.passwordTips=t),placeholder:"password tips",required:""},null,512),[[p.vModelText,e.form.passwordTips]])])])),_:1})}const W=(0,p.defineComponent)({...d,props:{},setup(e,{emit:t}){const o=(0,p.reactive)({newPassword:"",confirmPassword:"",passwordTips:""});return{form:o,validate:()=>o.newPassword===o.confirmPassword||(window.alert("passwod not match"),!1),submit(){t("ok",o)}}}});function X(e,t){const o=(0,p.resolveComponent)("ExportForm"),n=(0,p.resolveComponent)("b-modal");return(0,p.openBlock)(),(0,p.createBlock)(n,{ref:"modal",size:"md",onOk:e.onModalOk,onShown:e.onModalShown,onHidden:e.onModalHidden,centered:""},{"modal-title":(0,p.withCtx)((()=>[(0,p.createTextVNode)("Export")])),default:(0,p.withCtx)((()=>[(0,p.createVNode)(o,{onOk:t[0]||(t[0]=t=>e.generate(t))})])),_:1},8,["onOk","onShown","onHidden"])}const Y=(0,p.defineComponent)({...u,components:{ExportForm:W},props:{authUris:Array},setup(e,{emit:t}){const o=(0,A.tv)(),n=(0,R.oR)(),r=L.O.encrypt.bind({$store:n}),a=(0,p.getCurrentInstance)();return{async generate({newPassword:t,passwordTips:n}){const s=await r({password:t,message:JSON.stringify(e.authUris)}),l=o.resolve({name:"home",query:{s,tips:n}});window.open(new URL(l.href,window.location.href).toString(),"_blank");const{modal:c}=a.refs;c.hide()},show(){const{modal:e}=a.refs;e.show()},onModalOk(e){t("ok",e)},onModalHidden(e){t("hidden",e)},onModalShown(e){t("shown",e)}}}});function Z(e,t){const o=document.createElement("span");document.body.appendChild(o);const n=(0,p.createVNode)(Y,{...t,onHidden(){(0,p.render)(null,o),o.remove()}});n.appContext={...e.appContext},(0,p.render)(n,o);const{componentInstance:r}=n;return r.show(),r}const ee=(0,p.defineComponent)({...n,components:{UnlockForm:$,TOTPList:T},setup(){const e=(0,p.ref)([]),t=(0,A.yj)(),o=(0,p.getCurrentInstance)(),{ctx:n}=o;return{route:t,authUris:e,totpAuthModalOnOk(e,t){const o=C.stringify(t);try{C.parse(o)}catch(t){return e.preventDefault(),console.error(t),void window.alert(t.message)}n.appendAuthUri(o)},showTotpAuthForm(){D(o,{onOk:n.totpAuthModalOnOk})},showExportModal(){Z(o,{authUris:e.value})},appendAuthUri(t){e.value.push(t)},setAuthUris(t){e.value=t}}}})}}]);